<admintpl file="header"/>
<link rel="stylesheet" href="__PUBLIC__/js/chosen/chosen.css">
<link rel="stylesheet" href="__PUBLIC__/js/chosen/docsupport/prism.css">

</head>
<body>
<div class="wrap js-check-wrap">
    <ul class="nav nav-tabs">
        <li><a href="{:U('index')}">渠道模板列表</a></li>
        <li class="active"><a href="javascript:void(0);">添加渠道模板</a></li>
    </ul>
    <form action="{:U('add')}" method="post" class="form-horizontal js-ajax-forms" enctype="multipart/form-data">
        <div class="row-fluid">
            <div class="span9">
                <table class="table table-bordered">

                    <tr>
                        <th>模板名称</th>
                        <td>
                            <input type="text" style="width: 200px;" required name="name" value="" />
                            <span class="form-required">*</span>
                        </td>
                    </tr>
                    <tr>
                        <th>自动分包</th>
                        <td>

                            <label class="radio"><input type="radio" name="is_auto_fenbo" value="1" >自动</label>

                            <label class="radio"><input type="radio" name="is_auto_fenbo" value="0" checked>不自动</label>

                        </td>

                    </tr>

                    <tr>
                        <th>游戏加速</th>
                        <td>

                            <label class="radio"><input type="radio" name="is_accelerate" value="1">加速</label>

                            <label class="radio"><input type="radio" name="is_accelerate" value="0" checked>不加速</label>

                        </td>

                    </tr>

                    <tr>
                        <th>SDK悬浮窗</th>
                        <td>

                            <label class="radio"><input type="radio" name="isdisplay_buoy" value="1">显示</label>

                            <label class="radio"><input type="radio" name="isdisplay_buoy" value="0" checked>不显示</label>

                        </td>

                    </tr>

                    <tr>
                        <th>SDK广告</th>
                        <td>

                            <label class="radio"><input type="radio" name="isdisplay_ad" value="1">显示</label>

                            <label class="radio"><input type="radio" name="isdisplay_ad" value="0" checked>不显示</label>

                        </td>

                    </tr>

                    <tr>
                        <th>手机绑定</th>
                        <td>
                            <label class="radio"><input type="radio" name="bind_mobile_enabled" value="1">显示</label>
                            <label class="radio"><input type="radio" name="bind_mobile_enabled" value="0" checked>隐藏</label>
                        </td>
                    </tr>
                    <tr>
                        <th>实名认证</th>
                        <td>
                            <label class="radio"><input type="radio" name="name_auth_enabled" value="1">显示</label>
                            <label class="radio"><input type="radio" name="name_auth_enabled" value="0" checked>隐藏</label>
                        </td>
                    </tr>
                    <tr>
                        <th>平台币</th>
                        <td>
                            <label class="radio"><input type="radio" name="platform_money_enabled" value="1">显示</label>
                            <label class="radio"><input type="radio" name="platform_money_enabled" value="0" checked>隐藏</label>
                        </td>
                    </tr>
                    <tr>
                        <th>工单联系方式</th>
                        <td>
                            <label class="radio"><input type="radio" name="question_contract_enabled" value="1" checked>显示</label>
                            <label class="radio"><input type="radio" name="question_contract_enabled" value="0" >隐藏</label>
                        </td>
                    </tr>
                    <tr>
                        <th>玩家注册</th>
                        <td>
                            <label class="radio"><input type="radio" name="register_enabled" value="1" checked>显示</label>
                            <label class="radio"><input type="radio" name="register_enabled" value="0" >隐藏</label>
                        </td>
                    </tr>
                    <tr>
                        <th>安卓折扣服</th>
                        <td>
                            <label class="radio"><input type="radio" name="android_discount_enabled" value="1" >显示</label>
                            <label class="radio"><input type="radio" name="android_discount_enabled" value="0" checked>隐藏</label>
                        </td>
                    </tr>

                    <tr>
                        <th>苹果折扣服</th>
                        <td>
                            <label class="radio"><input type="radio" name="ios_discount_enabled" value="1" >显示</label>
                            <label class="radio"><input type="radio" name="ios_discount_enabled" value="0" checked>隐藏</label>
                        </td>
                    </tr>

                    <tr>
                        <th>账号交易</th>
                        <td>
                            <label class="radio"><input type="radio" name="business_enbaled" value="1" checked>显示</label>
                            <label class="radio"><input type="radio" name="business_enbaled" value="0" >隐藏</label>
                        </td>
                    </tr>

                    <tr>
                        <th>盒子下载</th>
                        <td>
                            <label class="radio"><input type="radio" name="box_download_enabled" value="1" >显示</label>
                            <label class="radio"><input type="radio" name="box_download_enabled" value="0" checked>隐藏</label>
                        </td>
                    </tr>
                    <tr>
                        <th>玩家行为统计</th>
                        <td>
                            <label class="radio"><input type="radio" name="actstatic_enabled" value="1" >是</label>
                            <label class="radio"><input type="radio" name="actstatic_enabled" value="0" checked>否</label>
                        </td>
                    </tr>
                    <tr>
                        <th>安卓精品</th>
                        <td>
                            <label class="radio"><input type="radio" name="android_product_enabled" value="1" >显示</label>
                            <label class="radio"><input type="radio" name="android_product_enabled" value="0" checked>隐藏</label>
                        </td>
                    </tr>

                    <tr>
                        <th>苹果精品</th>
                        <td>
                            <label class="radio"><input type="radio" name="ios_product_enabled" value="1" >显示</label>
                            <label class="radio"><input type="radio" name="ios_product_enabled" value="0" checked>隐藏</label>
                        </td>
                    </tr>

                    <tr class="ad" style="display:none;">
                        <th style="width:130px;">SDK广告跳转URL</th>
                        <td><input type="text" name="ad_url" value="" style="width: 400px"></td>
                    </tr>
                    <tr>
                        <th>客服qq</th>
                        <td><input type="text" name="qq" value="" style="width: 200px"></td>
                    </tr>
                    <tr>
                        <th>手游客服qq</th>
                        <td>qq号码：<input type="text" name="shouyou_qq_number" value="" style="width: 200px"> <!--qq链接：<input type="text" name="shouyou_qq_link" value="" style="width: 600px">--></td>
                    </tr>
                    <tr>
                        <th>返利客服qq</th>
                        <td>qq号码：<input type="text" name="fanli_qq_number" value="" style="width: 200px"> <!--qq链接：<input type="text" name="fanli_qq_link" value="" style="width: 600px">--></td>
                    </tr>
                    <tr>
                        <th>手游玩家群</th>
                        <td>qq群号码：<input type="text" name="shouyou_group_number" value="" style="width: 200px"> 群链接：<input type="text" name="shouyou_group_link" value="" style="width: 600px">  <a href="javascript:void(0)" class="help">如何生成链接</a><br>web群链接：<input type="text" name="shouyou_group_weblink" value="" style="width: 600px;margin-top:10px;"> </td>
                    </tr>
                    <tr>
                        <th>盒子交流群</th>
                        <td>qq群号码：<input type="text" name="box_group_number" value="" style="width: 200px"> 群链接：<input type="text" name="box_group_link" value="" style="width: 600px">  <a href="javascript:void(0)" class="help">如何生成链接</a><br>web群链接：<input type="text" name="box_group_weblink" value="" style="width: 600px;margin-top:10px;"></td>
                    </tr>
                    <tr>
                        <th>每周休息天数</th>
                        <td>
                            <select name="off_days">
                                <option value="1">1天</option>
                                <option value="2" selected>2天</option>
                            </select>
                        </td>
                    </tr>



                </table>
            </div>
            <div class="span3">
                <table class="table table-bordered ad"  style="display:none;">
                    <tr>
                        <th>SDK广告图片</th>
                    </tr>
                    <tr>
                        <td>
                            <div style="text-align: center;">
                                <input type="hidden" name="ad_pic" id="thumb" value="">
                                <a href="javascript:upload_one_image('图片上传','#thumb');">
                                    <img src="__TMPL__Public/assets/images/default-thumbnail.png" id="thumb-preview" width="135" style="cursor: hand" />
                                </a>
                                <input type="button" class="btn btn-small" onclick="$('#thumb-preview').attr('src','__TMPL__Public/assets/images/default-thumbnail.png');$('#thumb').val('');return false;" value="取消图片">
                                <span style="display:block;color:red;margin-left:-75px;">广告位图片规格300*250</span>
                            </div>
                        </td>
                    </tr>


                </table>
            </div>
        </div>
        <div class="form-actions">
            <button class="btn btn-primary js-ajax-submit" type="submit">{:L("ADD")}</button>
            <a class="btn" href="javascript:history.back(-1);">{:L('BACK')}</a>
        </div>
    </form>
</div>
<div class="show" style="display: none;">
    <p>1、打开<a href="http://qun.qq.com/join.html" target="_blank">http://qun.qq.com/join.html</a></p>
    <p>2、如图操作</p>
    <p><img src="__PUBLIC__/images/help.png"></p>
</div>
<script type="text/javascript" src="__PUBLIC__/js/common.js"></script>
<script src="__PUBLIC__/js/chosen/chosen.jquery.js" type="text/javascript"></script>
<script src="__PUBLIC__/js/chosen/docsupport/prism.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/layer/layer.js"></script>
<script type="text/javascript">
    var config = {
        '.chosen-select'           : {},
        '.chosen-select-deselect'  : {allow_single_deselect:true},
        '.chosen-select-no-single' : {disable_search_threshold:10},
        '.chosen-select-no-results': {no_results_text:'没有匹配的结果'},
        'search_contains':true,
        '.chosen-select-width'     : {width:"95%"}
    }
    for (var selector in config) {
        $(selector).chosen(config[selector]);
    }
    $('.help').click(function(){
        layer.open({
            type: 1,
            skin: 'layui-layer-demo', //样式类名
            closeBtn: 0, //不显示关闭按钮
            anim: 2,
            area: ['auto', 'auto'],
            shadeClose: true, //开启遮罩关闭
            content: $('.show')
        });
    })
    //$("#select_1").val('{$game_id}');
    //$("#select_1").trigger("chosen:updated");
    $(document).ready(function(){
        $('input[name=channel_template]').change(function(){
            alert($(this).val());
        });
        $("input[name='isdisplay_ad']").click(function(){

            if($(this).val() == 1)
            {
                $('.ad').show();
            }
            else
            {
                $("input[name='ad_url']").val('');
                $("input[name='ad_pic']").val('');
                $('#thumb-preview').attr('src','__TMPL__Public/assets/images/default-thumbnail.png');
                $('.ad').hide();

            }

        })

    });

    Wind.use('validate', 'ajaxForm', 'artDialog', function() {
        //javascript

        //编辑器
        editorcontent = new baidu.editor.ui.Editor();
        editorcontent.render('content');
        try {
            editorcontent.sync();
        } catch (err) {
        }
        //增加编辑器验证规则
        jQuery.validator.addMethod('editorcontent', function() {
            try {
                editorcontent.sync();
            } catch (err) {
            }
            return editorcontent.hasContents();
        });
        var form = $('form.js-ajax-forms');
        //ie处理placeholder提交问题
        if ($.browser && $.browser.msie) {
            form.find('[placeholder]').each(function() {
                var input = $(this);
                if (input.val() == input.attr('placeholder')) {
                    input.val('');
                }
            });
        }

        var formloading = false;
        //表单验证开始
        form.validate({
            //是否在获取焦点时验证
            onfocusout : false,
            //是否在敲击键盘时验证
            onkeyup : false,
            //当鼠标掉级时验证
            onclick : false,
            //验证错误
            showErrors : function(errorMap, errorArr) {
                //errorMap {'name':'错误信息'}
                //errorArr [{'message':'错误信息',element:({})}]
                try {
                    $(errorArr[0].element).focus();
                    art.dialog({
                        id : 'error',
                        icon : 'error',
                        lock : true,
                        fixed : true,
                        background : "#CCCCCC",
                        opacity : 0,
                        content : errorArr[0].message,
                        cancelVal : '确定',
                        cancel : function() {
                            $(errorArr[0].element).focus();
                        }
                    });
                } catch (err) {
                }
            },
            //验证规则
            rules: {'name':{required:1}},
            //验证未通过提示消息
            messages: {'name':{required:'请输入渠道名称'}},
            //给未通过验证的元素加效果,闪烁等
            highlight: false,
            //是否在获取焦点时验证
            onfocusout: false,
            //验证通过，提交表单
            submitHandler: function (forms) {
                $(forms).ajaxSubmit({
                    url: form.attr('action'), //按钮上是否自定义提交地址(多按钮情况)
                    dataType: 'json',
                    beforeSubmit: function (arr, $form, options) {
                    },

                    success: function (data, statusText, xhr, $form) {

                        if(data.status){

                            setCookie("refersh_time",1);

                            //添加成功

                            Wind.use("artDialog", function () {

                                art.dialog({

                                    id: "succeed",

                                    icon: "succeed",

                                    fixed: true,

                                    lock: true,

                                    background: "#CCCCCC",

                                    opacity: 0,

                                    content: data.info,

                                    button:[

                                        {

                                            name: '继续{:isset($info['id'])?'编辑':'添加'}？',

                                            callback:function(){

                                                reloadPage(window);

                                                return true;

                                            },

                                            focus: true

                                        },{

                                            name: '返回列表',

                                            callback:function(){

                                                location.href="__URL__";

                                                return true;

                                            }

                                        }

                                    ]

                                });

                            });

                        }else{

                            isalert(data.info);

                        }

                    }

                });

            }

        });

    });

</script>

</body>
</html>